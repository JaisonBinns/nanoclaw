# Agent Teams

NanoClaw supports Claude Code's experimental agent teams feature, enabling multi-agent collaboration within each group.

## What Are Agent Teams?

Agent teams allow the main agent to delegate specialized tasks to specialist agents. Each specialist has:
- Its own `CLAUDE.md` file with focused instructions
- Access to the same workspace and tools
- Ability to collaborate with other specialists
- Isolation from other groups (same security boundaries)

## When to Use Agent Teams

Use specialist agents for:
- **Domain expertise** - Separate agents for frontend, backend, database, etc.
- **Complex workflows** - Break large tasks into specialized subtasks
- **Parallel work** - Multiple agents working on independent components
- **Role separation** - Different agents for research, implementation, testing

## Creating a Specialist Agent

### 1. Create the specialist directory

```bash
# Inside a group folder (e.g., groups/main/)
mkdir -p agents/frontend
```

### 2. Create the specialist's CLAUDE.md

```bash
# groups/main/agents/frontend/CLAUDE.md
cat > agents/frontend/CLAUDE.md << 'EOF'
# Frontend Specialist

You are a frontend specialist focusing on React, TypeScript, and UI/UX.

## Responsibilities
- Implement React components
- Handle styling and responsiveness
- Optimize frontend performance
- Ensure accessibility

## Tech Stack
- React 18
- TypeScript
- Tailwind CSS
- Vite

## Guidelines
- Use functional components with hooks
- Write accessible HTML (ARIA labels, semantic elements)
- Mobile-first responsive design
- Performance: lazy loading, code splitting
EOF
```

### 3. Delegate tasks from the main agent

The main agent can now delegate to specialists:

```
User: "Add a new user dashboard page"

Main Agent: I'll delegate the UI work to our frontend specialist.
/delegate frontend "Create a responsive user dashboard page with profile card, activity feed, and settings panel"

Frontend Agent: I'll create the dashboard components...
[Creates React components, styles, etc.]
```

## Example Specialist Structures

### Backend Specialist
```
groups/main/agents/backend/
  CLAUDE.md          # API design, database, auth
  schemas/           # Database schemas
  endpoints.md       # API documentation
```

### Database Specialist
```
groups/main/agents/database/
  CLAUDE.md          # SQL queries, migrations, optimization
  migrations/        # Schema migration history
  queries.md         # Common query patterns
```

### Testing Specialist
```
groups/main/agents/testing/
  CLAUDE.md          # Test strategies, coverage
  test-plan.md       # Test scenarios
  fixtures/          # Test data
```

## Multi-Agent Workflow Example

A typical multi-agent workflow:

1. **User request**: "Add user authentication"
2. **Main agent** analyzes and plans:
   - Database schema changes
   - Backend API endpoints
   - Frontend login UI
3. **Main agent delegates**:
   - `/delegate database "Add users table with email, password_hash, created_at"`
   - `/delegate backend "Create /auth/login and /auth/register endpoints"`
   - `/delegate frontend "Build login and registration forms"`
4. **Specialists work** in parallel
5. **Main agent integrates** and coordinates
6. **Testing specialist** validates the complete feature

## Agent Team Permissions

Specialists inherit the security boundaries of their parent group:
- **Main group specialists**: Can access project root, all IPC commands
- **Other group specialists**: Limited to their group folder, restricted IPC

Specialists **cannot**:
- Access other groups' data
- Bypass mount allowlists
- Escalate privileges beyond parent group

## Configuration

Agent teams are enabled automatically via `.claude/settings.json`:

```json
{
  "env": {
    "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1",
    "CLAUDE_CODE_ADDITIONAL_DIRECTORIES_CLAUDE_MD": "1",
    "CLAUDE_CODE_DISABLE_AUTO_MEMORY": "0"
  }
}
```

This file is automatically generated for each group on first run.

## Best Practices

### 1. Keep specialists focused
Each specialist should have a clear, narrow domain. Avoid overlap.

### 2. Document handoffs
When delegating, provide context and acceptance criteria:
```
/delegate frontend "Create user profile component. Should display:
- Avatar image
- Username and email
- Edit button (navigates to /profile/edit)
- Should be responsive, match design system"
```

### 3. Use shared context
Specialists can access shared files:
```
groups/main/
  CLAUDE.md              # Main agent
  design-system.md       # Shared guidelines
  agents/
    frontend/CLAUDE.md   # Can reference ../design-system.md
    backend/CLAUDE.md    # Can reference ../design-system.md
```

### 4. Coordinate via main agent
Let the main agent orchestrate. Specialists should not directly communicate.

### 5. Monitor specialist activity
Check `groups/{name}/logs/` to see what specialists are doing.

## Troubleshooting

### Specialist not found
- Verify `agents/{name}/CLAUDE.md` exists
- Check file permissions (must be readable)
- Restart the container

### Delegation fails
- Ensure experimental flag is enabled in settings.json
- Check logs: `tail -f ~/nanoclaw/nanoclaw.log`
- Verify the specialist's CLAUDE.md is valid markdown

### Specialists conflict
- Review each specialist's domain in CLAUDE.md
- Add coordination guidelines to main agent CLAUDE.md
- Consider merging overlapping specialists

## Example: Full Stack Feature with Agent Teams

```
User: "Add a todo list feature with API and UI"

Main Agent:
  1. Plans architecture
  2. Delegates to specialists:
     - /delegate database "Create todos table (id, user_id, title, done, created_at)"
     - /delegate backend "Create CRUD endpoints for todos"
     - /delegate frontend "Build todo list UI with add/edit/delete"
  3. Coordinates integration
  4. Delegates testing:
     - /delegate testing "Write integration tests for todo feature"

Result: Complete feature implemented collaboratively by 4 specialists.
```

## See Also

- [REQUIREMENTS.md](REQUIREMENTS.md) - NanoClaw architecture
- [Container isolation](../CLAUDE.md#development) - Security boundaries
- [Claude Code Agent Teams docs](https://docs.anthropic.com/claude-code/agent-teams)
